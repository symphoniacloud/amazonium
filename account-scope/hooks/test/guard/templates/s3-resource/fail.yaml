# Test template for S3 resource Guard rules - FAILING scenarios
# This template demonstrates various violations of the Guard rules

HookContext:
  AWSAccountID: "123456789012"
  StackId: "arn:aws:cloudformation:us-west-2:123456789012:stack/my-app-stack/1a2b3c4d-5e6f-7890-abcd-ef1234567890"
  HookTypeName: "AWS::S3::BucketGuard"
  HookTypeVersion: "1.0"
  InvocationPoint: "CREATE_PRE_PROVISION"
  TargetName: "AWS::S3::Bucket"
  TargetType: "RESOURCE"

Resources:
  # VIOLATION: Missing BucketEncryption property entirely
  NoEncryptionBucket:
    Type: AWS::S3::Bucket
    Properties:
      # Naming is correct for context: my-app-stack-123456789012-us-west-2-bucket
      BucketName: my-app-stack-123456789012-us-west-2-bucket
      # Missing: BucketEncryption property
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  # VIOLATION: Invalid encryption algorithm
  InvalidEncryptionBucket:
    Type: AWS::S3::Bucket
    Properties:
      BucketName: my-app-stack-123456789012-us-west-2-bucket
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              # VIOLATION: Invalid algorithm (not aws:kms or AES256)
              SSEAlgorithm: INVALID_ALGORITHM
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true

  # VIOLATION: Missing BucketName property
  MissingNameBucket:
    Type: AWS::S3::Bucket
    Properties:
      # Missing: BucketName property
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256

  # VIOLATION: Wrong naming pattern - doesn't match runtime context
  WrongNamePatternBucket:
    Type: AWS::S3::Bucket
    Properties:
      # VIOLATION: Name doesn't match context
      # Expected: my-app-stack-123456789012-us-west-2-bucket
      # Actual: wrong-stack-999999999999-us-east-1-bucket
      BucketName: wrong-stack-999999999999-us-east-1-bucket
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: aws:kms
              KMSMasterKeyID: alias/aws/s3

  # VIOLATION: Wrong account ID in name
  WrongAccountBucket:
    Type: AWS::S3::Bucket
    Properties:
      # VIOLATION: Account ID doesn't match (should be 123456789012)
      BucketName: my-app-stack-999999999999-us-west-2-bucket
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256

  # VIOLATION: Wrong region in name
  WrongRegionBucket:
    Type: AWS::S3::Bucket
    Properties:
      # VIOLATION: Region doesn't match (should be us-west-2 from StackId)
      BucketName: my-app-stack-123456789012-us-east-1-bucket
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256

  # VIOLATION: Missing -bucket suffix
  MissingSuffixBucket:
    Type: AWS::S3::Bucket
    Properties:
      # VIOLATION: Missing "-bucket" suffix
      BucketName: my-app-stack-123456789012-us-west-2
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: aws:kms
